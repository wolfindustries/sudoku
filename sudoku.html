<!DOCTYPE html>
<head>
    <style type="text/css">
        html 
        {
            font-family:Arial, Helvetica, sans-serif;
            background-color:#333;
        }
        div#main {
            width:600px;
            height:600px;
            position:absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -49%);
        }

        div.section {
            border:2px solid #000;
        }

        div#main, div.section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            grid-auto-flow: column;
        }

        div.cell {
            display:flex;
            justify-content: center;
            align-items: center;
            border:1px solid #000;
            margin:-1px -1px 0 0;
            background-color:#fff;
        }

        div.cell p.display {
            margin:0;
            padding:0;
            font-size:2em;  
            text-align: center;
        }

        div.cell p.hint {
            margin:0 0 2.8em 0;
            padding:0;
            font-size:1em;
            text-align: center;
            position:absolute;
        }
    </style>
</head>
<body>
<div id="main"></div>
</body>
</html>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", ()=> {
    setupSudoku();
})

function setupSudoku()
{
    let main = document.getElementById("main");
    let sudoku = new Sudoku(main);

    //generateBoard();
}

function _checkRowFor(gY, cY, val)
{

}

class Cell {
    constructor(gridX, gridY, cellX, cellY) {
        this.div = document.createElement("div");
        this.div.setAttribute("class", "cell");

        this.display = document.createElement("p");
        this.display.innerText = "0";
        this.display.setAttribute("class", "display");
        this.div.append(this.display);

        this.hint = document.createElement("p");
        this.hint.innerText = gridX + "," + gridY + " " + cellX + "," + cellY;
        this.hint.setAttribute("class", "hint");
        this.div.append(this.hint);

        this.gridX = gridX;
        this.gridY = gridY;
        this.cellX = cellX;
        this.cellY = cellY;

        this.canChange = true;
        this.currentValue = 0;
        this.setCurrentValue(0);
    }

    setCurrentValue(val)
    {
        if(this.canChange) {
            this.currentValue = val;
            this.display.innerText = "" + val;
        }
    }

    setCanChange(val)
    {
        this.canChange = val;
    }
}

class Sudoku {
    constructor(parent) {
        this.parent = parent;
        this.grid = Array();

        this.build();
    }

    build() {
        for(var gridX = 0; gridX < 3; gridX++)
        {
            for(var gridY = 0; gridY < 3; gridY++)
            {
                var section = document.createElement("div");
                section.setAttribute("class", "section");

                for(var cellX = 0; cellX < 3; cellX++)
                {
                    for(var cellY = 0; cellY < 3; cellY++)
                    {
                        var cell = new Cell(gridX, gridY, cellX, cellY);
                        section.append(cell.div);
                        
                        this.addToArr(gridX, gridY, cellX, cellY, cell);
                    }
                }

                main.append(section);
            }
        }

        this.populateBoard();
    }

    addToArr(gridX, gridY, cellX, cellY, cell)
    {
        if(!this.grid[gridX])
        {
            this.grid[gridX] = new Array();
        }
        if(!this.grid[gridX][gridY])
        {
            this.grid[gridX][gridY] = new Array();
        }
        if(!this.grid[gridX][gridY][cellX])
        {
            this.grid[gridX][gridY][cellX] = new Array();
        }

        this.grid[gridX][gridY][cellX][cellY] = cell;
    }

    assignValue(gX, gY, cX, cY, values, stackDepth = 0)
    {
        while(stackDepth < 10) {
            var randomValue = Math.floor(Math.random() * values.length);

            if(this.checkColFor(gX, cX, values[randomValue]) && this.checkRowFor(gY, cY, values[randomValue])) {
                this.grid[gX][gY][cX][cY].setCurrentValue(values[randomValue])
                values.splice(randomValue, 1);
                return;
            }

            stackDepth++;
        }
        console.log("ERRORED OUT");
    }

    checkColFor(gX, cX, val)
    {
        for(var gY = 0; gY < 3; gY++)
        {
            for(var cY = 0; cY < 3; cY++)
            {
                if(this.grid[gX][gY][cX][cY].currentValue == val)
                {
                    console.log("duplicate found");
                    return false;
                }
            }
        }

        return true;
    }

    checkRowFor(gY, cY, val)
    {
        for(var gX = 0; gX < 3; gX++)
        {
            for(var cX = 0; cX < 3; cX++)
            {
                if(this.grid[gX][gY][cX][cY].currentValue == val)
                {
                    console.log("duplicate found");
                    return false;
                }
            }
        }

        return true;
    }

    populateBoard()
    {
        for(var gX = 0; gX < 3; gX++)
        {
            for(var gY = 0; gY < 3; gY++) 
            {
                console.log('boop');
                var sectionVals = Array();
                for(var i = 0; i < 10; i++)
                {
                    sectionVals.push(i);
                }

                for(var cX = 0; cX < 3; cX++)
                {
                    for(var cY = 0; cY < 3; cY++)
                    {
                        this.assignValue(gX, gY, cX, cY, sectionVals);
                    }
                }
            }
        }
    }

}
</script>